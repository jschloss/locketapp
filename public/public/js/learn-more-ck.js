/////////////////////////////////////////////////////////
//
// Fade in content when backgound video is loaded
// and set cookie for returning users
//
/////////////////////////////////////////////////////////
function returningUser(){$("#above-the-fold .hero").addClass("watch-again");$("#above-the-fold h1 strong").text("See it");$("#above-the-fold h1 em").text("again");$("#above-the-fold h2").text("Or scroll to learn more")}function resizeToCover(){jQuery("#video-viewport.playing").width(jQuery(window).width());jQuery("#video-viewport.playing").height(jQuery(window).height());var e=jQuery(window).width()/vid_w_orig,t=jQuery(window).height()/vid_h_orig,n=e>t?e:t;n*vid_w_orig<min_w&&(n=min_w/vid_w_orig);jQuery("video").width(n*vid_w_orig);jQuery("video").height(n*vid_h_orig);jQuery("#video-viewport.playing").scrollLeft((jQuery("video").width()-jQuery(window).width())/2);jQuery("#video-viewport.playing").scrollTop((jQuery("video").height()-jQuery(window).height())/2)}function resizeDiv(){vph=window.innerHeight?window.innerHeight:$(window).height();$("#above-the-fold.playing").css({height:vph});$("#what-is-locket").css({"margin-top":vph})}var video=document.getElementById("locket-background-video");video.addEventListener("canplaythrough",function(){$("#loaded-content").css({visibility:"visible"}).animate({opacity:1},1e3);setTimeout(function(){$("#loading-spinner").remove()},1100);$.cookie("returning")=="yes"?$("body").css("overflow-y","visible"):$.cookie("returning","yes",{expires:30,path:"/"})},!1);playButton=$("#video-play-trigger, #above-the-fold h1, #above-the-fold h2");heroContent=$("#above-the-fold div.hero");backgroundVideo=$("#locket-background-video");playedVideo=$("#locket-played-video");wrapper=$("#video-viewport");if(!navigator.userAgent.match(/(iPod|iPhone)/i)){playedVideo.get(0).pause();function openVideo(){if(navigator.userAgent.match(/(iPad)/i)){wrapper.css({visibility:"visible","z-index":"3"});$("h1.logo a").fadeOut();$("h1.logo").append('<span id="logo-back-button">&#xe008;</span>').on("click",function(){location.reload()});setTimeout(function(){$("#logo-back-button").fadeIn()},500)}heroContent.addClass("hidden");playedVideo.fadeIn(350);playedVideo.get(0).play();playedVideo.on("ended",function(){closeVideo();navigator.userAgent.match(/(iPad)/i)||returningUser()});backgroundVideo.get(0).pause();backgroundVideo.delay(350).fadeOut("fast")}function closeVideo(){heroContent.removeClass("hidden");$("header").removeClass("faded");$("body").css({"overflow-y":"visible","overflow-x":"hidden"});backgroundVideo.show();backgroundVideo.get(0).play();playedVideo.get(0).pause();playedVideo.fadeOut();if(navigator.userAgent.match(/(iPad)/i)){$("#logo-back-button").fadeOut();$("h1.logo a").fadeIn();wrapper.css({visibility:"hidden","z-index":"1"})}}$("#above-the-fold .hero").on("click",playButton,function(){openVideo()});$(window).on("scroll",function(){$(document).scrollTop()>=playedVideo.height()&&closeVideo()})}else $("#above-the-fold .hero").on("click",playButton,function(){playedVideo.show().get(0).play()});var min_w=300,vid_w_orig,vid_h_orig;jQuery(function(){vid_w_orig=parseInt(jQuery("video").attr("width"));vid_h_orig=parseInt(jQuery("video").attr("height"));$("#debug").append("<p>DOM loaded</p>");jQuery(window).resize(function(){resizeToCover()});jQuery(window).trigger("resize")});$(document).ready(function(){resizeDiv()});navigator.userAgent.match(/(iPhone|iPod|iPad)/i)||(window.onresize=function(e){resizeDiv()});$(function(){setInterval(function(){$("section:onScreen").addClass("play")},1e3)});navigator.userAgent.match(/(iPhone|iPod|iPad)/i)||$(window).bind("scroll",function(){var e=$(document).scrollTop(),t=0,n=0,r=jQuery(window).height()/1.75,i=$("#video-viewport");e<=n?t=1:e<=r&&(t=1-e/r);i.css("opacity",t)});$(window).on("scroll",function(){var e=$(document).scrollTop(),t=$("header"),n=$("#above-the-fold").outerHeight()/2,r=$("header h1.logo"),i=$("#above-the-fold").outerHeight()+$("#what-is-locket").outerHeight()-40,s=i+$("section#security").outerHeight();if(navigator.userAgent.match(/(iPhone|iPod)/i))var n=80+$("#above-the-fold").height();if(e>=n&&e<i||e>=s){t.addClass("scrolled").removeClass("faded");r.removeClass("light")}else if(!navigator.userAgent.match(/(iPhone|iPod|iPad)/i)&&e>=i&&e<s)r.addClass("light");else if(e<40){t.removeClass("scrolled");r.addClass("light")}});var API_URL="http://cdn.api.twitter.com/1/urls/count.json",TWEET_URL="https://twitter.com/intent/tweet";$(".tweet").each(function(){var e=$(this),t=encodeURIComponent(e.attr("data-url")||document.location.href),n=e.attr("data-text")||document.title,r=e.attr("data-via")||"",i=encodeURIComponent(e.attr("data-related"))||"",s=encodeURIComponent(e.attr("data-hashtags"))||"";e.attr({href:TWEET_URL+"?hashtags="+s+"&original_referer="+encodeURIComponent(document.location.href)+"&related="+i+"&source=tweetbutton&text="+n+"&url="+t,target:"_blank"})});Parse.initialize("aGV3jgoaAKQHf7mtBA4dSzMgQVPLBLItyN3dm7up","QvCI9dOzz9zszyWSm1nzlqGdARN7tWhxejabFn0C");var LocketVote=Parse.Object.extend("Vote"),locketVote=new LocketVote;$(document).ready(function(){var e=$("ul#vote li").map(function(e,t){return $(t).attr("id")}),t=new Parse.Query(LocketVote);t.startsWith("candidate","vote");t.find({success:function(e){var t=0;for(var n=0;n<e.length;n++){var r=e[n],i=r.get("votes");t+=i;var s=r.get("candidate"),o=$("#"+s);if(o){var u=o.children("span.count");u.html(i)}}$("#votes-so-far strong").text(t);var a=Math.round(t/500*100/10)*10;$("#progress-bar span").css("width",a+"%");var f=new Date("2013 august 12"),l=new Date,c=Math.round((f-l)/864e5);if(c<0)var c=0;$("#days-left strong").text(c)},error:function(e){alert("beep boop")}})});$("ul#vote li").on("click",function(e){var t=$(this).attr("id"),n=$(this).children("span.count"),r=new Parse.Query(LocketVote);r.equalTo("candidate",t);r.find({success:function(e){for(var t=0;t<e.length;t++){var i=e[t];r.get(i.id,{success:function(e){e.increment("votes");e.save();var t=e.get("votes");n.html(t);var r=$("#just-the-beginning h4 strong");r.text(Number(r.text())+1)}})}}})});